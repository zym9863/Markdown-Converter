<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="现代化的Markdown转换器，支持实时预览和多种主题">
    <meta name="theme-color" content="#3b82f6">

    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Markdown转换器">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MD转换器">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-config" content="none">
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-tap-highlight" content="no">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-128x128.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-96x96.png">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="mask-icon" href="icons/icon-192x192.png" color="#3b82f6">

    <title>Markdown转换器 - 现代化编辑器</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header" role="banner">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="title-icon">📝</span>
                    Markdown转换器
                </h1>
                <p class="app-subtitle">现代化编辑器，支持实时预览</p>
            </div>
            <nav class="toolbar" role="toolbar" aria-label="工具栏">
                <button id="theme-toggle" class="btn" aria-label="切换主题" title="切换明暗主题">
                    <span class="btn-icon">🌓</span>
                    <span class="btn-text">切换主题</span>
                </button>
                <button id="clear-btn" class="btn" aria-label="清空内容" title="清空编辑器内容">
                    <span class="btn-icon">🗑️</span>
                    <span class="btn-text">清空</span>
                </button>
                <button id="export-btn" class="btn" aria-label="导出HTML文件" title="导出为HTML文件">
                    <span class="btn-icon">📁</span>
                    <span class="btn-text">导出HTML</span>
                </button>
                <button id="copy-btn" class="btn" aria-label="复制HTML代码" title="复制HTML代码到剪贴板">
                    <span class="btn-icon">📋</span>
                    <span class="btn-text">复制HTML</span>
                </button>
            </nav>
        </header>
        
        <main class="editor-container" role="main">
            <section class="editor-panel" aria-labelledby="editor-title">
                <h3 id="editor-title" class="panel-title">
                    <span class="panel-icon">✏️</span>
                    Markdown输入
                </h3>
                <div class="editor-wrapper">
                    <textarea
                        id="markdown-input"
                        class="markdown-editor"
                        placeholder="在这里输入您的Markdown内容...

# 示例标题
这是一段**粗体文本**和*斜体文本*的示例。

## 列表示例
- 列表项1
- 列表项2
  - 子列表项

## 代码示例
```javascript
function hello() {
    console.log('Hello, World!');
}
```

## 链接示例
[访问GitHub](https://github.com)

> 这是一个引用块
"
                        aria-label="Markdown编辑器"
                        spellcheck="false"
                        autocomplete="off">
                    </textarea>
                </div>
                <footer class="stats" role="status" aria-live="polite">
                    <span id="char-count" class="stat-item">
                        <span class="stat-icon">📊</span>
                        字符数: 0
                    </span>
                    <span id="word-count" class="stat-item">
                        <span class="stat-icon">📝</span>
                        单词数: 0
                    </span>
                </footer>
            </section>

            <section class="preview-panel" aria-labelledby="preview-title">
                <h3 id="preview-title" class="panel-title">
                    <span class="panel-icon">👁️</span>
                    HTML预览
                </h3>
                <div id="html-preview" class="preview-content" role="region" aria-label="HTML预览区域">
                    <p class="preview-placeholder">
                        <span class="placeholder-icon">💭</span>
                        在左侧输入Markdown内容，这里将显示实时预览...
                    </p>
                </div>
            </section>
        </main>
        
        <footer class="footer" role="contentinfo">
            <div class="footer-content">
                <p class="supported-features">
                    <span class="features-icon">⚡</span>
                    <strong>支持的语法：</strong>
                    <span class="feature-tags">
                        <span class="feature-tag">标题</span>
                        <span class="feature-tag">粗体/斜体</span>
                        <span class="feature-tag">列表</span>
                        <span class="feature-tag">代码块</span>
                        <span class="feature-tag">链接</span>
                        <span class="feature-tag">图片</span>
                        <span class="feature-tag">引用块</span>
                        <span class="feature-tag">表格</span>
                    </span>
                </p>
                <p class="app-info">
                    <small>
                        <span class="version-badge">v2.0</span>
                        现代化Markdown转换器
                    </small>
                </p>
            </div>
        </footer>
    </div>
    
    <!-- 导入JavaScript文件 -->
    <script src="markdown-parser.js"></script>
    <script src="converter.js"></script>
    <script src="script.js"></script>

    <!-- PWA Service Worker 注册 -->
    <script>
        /**
         * 注册Service Worker
         * 提供PWA功能和离线支持
         */
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('✅ Service Worker 注册成功:', registration.scope);

                        // 检查更新
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // 有新版本可用
                                    if (confirm('发现新版本，是否立即更新？')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('❌ Service Worker 注册失败:', error);
                    });

                // 监听Service Worker控制器变化
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    console.log('🔄 Service Worker 已更新');
                    window.location.reload();
                });
            });
        }

        /**
         * PWA安装提示
         * 检测并提示用户安装PWA应用
         */
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('💾 PWA 安装提示已准备');
            e.preventDefault();
            deferredPrompt = e;

            // 创建安装按钮
            const installButton = document.createElement('button');
            installButton.textContent = '📱 安装应用';
            installButton.className = 'btn install-btn';
            installButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
                background: #3b82f6;
                color: white;
                border: none;
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s ease;
            `;

            installButton.addEventListener('mouseenter', () => {
                installButton.style.transform = 'translateY(-2px)';
                installButton.style.boxShadow = '0 6px 16px rgba(59, 130, 246, 0.4)';
            });

            installButton.addEventListener('mouseleave', () => {
                installButton.style.transform = 'translateY(0)';
                installButton.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
            });

            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`📲 用户${outcome === 'accepted' ? '接受' : '拒绝'}了安装提示`);
                    deferredPrompt = null;
                    installButton.remove();
                }
            });

            document.body.appendChild(installButton);

            // 3秒后自动隐藏安装按钮
            setTimeout(() => {
                if (installButton.parentNode) {
                    installButton.style.opacity = '0.7';
                }
            }, 3000);
        });

        // PWA安装完成后隐藏安装按钮
        window.addEventListener('appinstalled', () => {
            console.log('🎉 PWA 安装成功');
            const installButton = document.querySelector('.install-btn');
            if (installButton) {
                installButton.remove();
            }
        });
    </script>
</body>
</html>